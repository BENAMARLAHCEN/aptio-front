<div class="space-y-4">
<!-- Date Navigation -->
<div class="flex items-center justify-between bg-neutral-light p-3 rounded-lg">
  <button
    (click)="onDateChange(-1)"
    class="p-1 rounded-full text-neutral-dark hover:bg-white focus:outline-none"
    title="Previous Day">
    <span class="material-icons-outlined">chevron_left</span>
  </button>

  <div class="flex items-center">
    <span class="material-icons-outlined mr-2 text-primary">calendar_today</span>
    <span class="font-medium">{{ formatDateForDisplay(selectedDate) }}</span>
    <button class="ml-2 p-1 rounded-full text-neutral-dark hover:bg-white focus:outline-none" title="Select Date">
      <span class="material-icons-outlined">event</span>
    </button>
  </div>

  <button
    (click)="onDateChange(1)"
    class="p-1 rounded-full text-neutral-dark hover:bg-white focus:outline-none"
    title="Next Day">
    <span class="material-icons-outlined">chevron_right</span>
  </button>
</div>

<!-- Staff Filters -->
<div class="bg-neutral-light p-3 rounded-lg">
  <div class="flex flex-wrap items-center gap-2">
    <span class="text-sm font-medium text-neutral-dark">Staff:</span>

    <div *ngFor="let member of staff" class="flex items-center">
      <button
        (click)="toggleStaffSelection(member.id)"
        class="flex items-center px-2 py-1 rounded-md text-sm"
        [class.bg-primary-light]="selectedStaffIds.includes(member.id)"
        [class.text-primary]="selectedStaffIds.includes(member.id)"
        [class.bg-white]="!selectedStaffIds.includes(member.id)"
        [class.text-neutral-dark]="!selectedStaffIds.includes(member.id)">
          <span
            class="w-3 h-3 rounded-full mr-1"
            [style.background-color]="member.color">
          </span>
        {{ member.firstName }} {{ member.lastName }}
      </button>
    </div>

    <div class="ml-auto flex items-center gap-2">
      <button
        (click)="selectAllStaff()"
        class="text-xs text-primary hover:underline">
        Select All
      </button>
      <span class="text-neutral-dark">|</span>
      <button
        (click)="deselectAllStaff()"
        class="text-xs text-primary hover:underline">
        Deselect All
      </button>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="flex justify-center p-8">
  <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
</div>

<!-- Error Message -->
<div *ngIf="errorMessage" class="p-4 bg-red-100 border border-red-300 text-red-700 rounded-lg">
  {{ errorMessage }}
  <button (click)="loadScheduleData()" class="ml-2 text-primary hover:underline">Try Again</button>
</div>

<!-- Schedule Grid -->
<div *ngIf="!isLoading && !errorMessage && scheduleSettings" class="relative overflow-x-auto">
  <div class="min-w-max">
    <!-- Header Row -->
    <div class="flex">
      <!-- Time column header -->
      <div class="w-20 flex-shrink-0"></div>

      <!-- Staff column headers -->
      <div
        *ngFor="let column of scheduleColumns"
        class="flex-1 min-w-48 p-2 text-center border-b border-neutral-light bg-neutral-light">
        <div class="font-medium text-neutral-dark">{{ column.staff.firstName }} {{ column.staff.lastName }}</div>
        <div class="text-xs text-neutral">{{ column.staff.position }}</div>
      </div>
    </div>

    <!-- Time Slots -->
    <div *ngFor="let slot of timeSlots" class="flex relative" [class.border-t]="slot.hourLabel">
      <!-- Time label -->
      <div class="w-20 flex-shrink-0 p-1 border-r border-neutral-light">
        <div *ngIf="slot.hourLabel" class="text-xs text-neutral-dark font-medium">
          {{ slot.hourLabel }}
        </div>
      </div>

      <!-- Staff columns -->
      <div
        *ngFor="let column of scheduleColumns"
        class="flex-1 min-w-48 h-12 border-r border-neutral-light relative">
        <!-- Appointment entries that fall in this time slot -->
        <ng-container *ngFor="let entry of column.entries">
          <div
            *ngIf="getAppointmentStyle(entry, slot.time)"
            [style]="getAppointmentStyle(entry, slot.time)"
            (click)="viewAppointment(entry.id)">
            {{ entry.title }}
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>

<!-- No Schedule Data -->
<div *ngIf="!isLoading && !errorMessage && scheduleColumns.length === 0" class="text-center p-8">
  <div class="text-neutral">No staff selected or no staff available for this day.</div>
</div>

<!-- Create Appointment Button -->
<div class="fixed bottom-6 right-6">
  <button
    (click)="createAppointment()"
    class="bg-primary text-white rounded-full p-4 shadow-lg hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
    <span class="material-icons-outlined">add</span>
  </button>
</div>
</div>
